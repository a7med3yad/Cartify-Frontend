<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cartify Merchant Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="dashboard-layout">
    <aside class="sidebar">
      <div class="sidebar__brand">
        <span class="brand-mark">Cartify</span>
        <small class="brand-subtitle">Merchant</small>
      </div>
      <nav class="sidebar__nav">
        <button class="nav-link" data-target="dashboard">Dashboard</button>
        <button class="nav-link active" data-target="products">Products</button>
        <button class="nav-link" data-target="orders">Orders</button>
        <button class="nav-link" data-target="inventory">Inventory</button>
        <button class="nav-link" data-target="settings">Settings</button>
      </nav>
      <div class="sidebar__footer">
        <p class="sidebar__user-label">Signed in as</p>
        <p class="sidebar__user" id="sidebarCurrentUser">merchant@cartify.dev</p>
      </div>
    </aside>

    <div class="workspace">
      <header class="workspace__header">
        <div>
          <p class="subtitle">Multi-vendor Console</p>
          <h1>Merchant Home</h1>
        </div>
        <div class="workspace__actions">
          <button class="btn ghost" id="refreshProductsBtn">Refresh</button>
          <button class="btn primary" id="openProductModalBtn">Add Product</button>
        </div>
      </header>

      <main class="view-panel">
        <!-- PRODUCTS -->
        <section id="productsSection" class="content-section active">
          <div class="section-heading">
            <div>
              <p class="subtitle">Catalog</p>
              <h2>Products</h2>
            </div>
            <div class="section-heading__actions">
              <div class="input-group">
                <input type="search" id="productSearchInput" placeholder="Search products by name">
              </div>
            </div>
          </div>

          <div class="card controls-card">
            <div>
              <p class="muted">Total products</p>
              <h3 id="productsCount">0</h3>
            </div>
            <div>
              <p class="muted">Merchant ID</p>
              <h4 id="merchantIdLabel">–</h4>
            </div>
            <div>
              <p class="muted">Store ID</p>
              <h4 id="storeIdLabel">–</h4>
            </div>
          </div>

          <div class="card table-card">
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>Description</th>
                    <th>Variants</th>
                    <th>Created</th>
                    <th style="width:200px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="productsTableBody">
                  <tr>
                    <td colspan="5" class="empty-row">Connect your merchant account to load products.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="productsEmptyState" class="empty-state hidden">
              <h3>No products yet</h3>
              <p>Add your first product to start listing variants and inventory.</p>
              <button class="btn primary" id="productsEmptyPrimaryBtn">Create product</button>
            </div>
          </div>
        </section>

        <!-- PRODUCT DETAILS -->
        <section id="productDetailsSection" class="content-section hidden">
          <div class="section-heading">
            <div>
              <button class="btn ghost" id="backToProductsBtn">← Products</button>
              <p class="subtitle">Variants</p>
              <h2 id="selectedProductTitle">Choose a product</h2>
            </div>
            <div class="section-heading__actions">
              <button class="btn" id="refreshProductDetailsBtn">Refresh</button>
              <button class="btn primary" id="addProductDetailBtn">Add Variant</button>
            </div>
          </div>

          <div class="card product-highlight">
            <div class="product-highlight__media">
              <img id="selectedProductImage" src="" alt="Product image">
            </div>
            <div class="product-highlight__body">
              <p class="muted">Product ID</p>
              <h4 id="selectedProductId">–</h4>
              <p id="selectedProductDescription" class="muted mt-2"></p>
            </div>
          </div>

          <div class="card table-card">
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Serial</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Description</th>
                    <th style="width:200px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="productDetailsTableBody">
                  <tr>
                    <td colspan="5" class="empty-row">Select a product to view its variants.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="productDetailsEmptyState" class="empty-state hidden">
              <h3>No variants yet</h3>
              <p>Create a variant to begin stocking inventory for this product.</p>
              <button class="btn primary" id="productDetailsEmptyBtn">Create variant</button>
            </div>
          </div>
        </section>

        <!-- INVENTORY -->
        <section id="inventorySection" class="content-section hidden">
          <div class="section-heading">
            <div>
              <button class="btn ghost" id="backToProductDetailsBtn">← Variants</button>
              <p class="subtitle">Inventory</p>
              <h2 id="inventoryHeaderName">Variant inventory</h2>
            </div>
            <div class="section-heading__actions">
              <button class="btn" id="refreshInventoryBtn">Refresh</button>
            </div>
          </div>

          <div class="summary-grid">
            <div class="summary-card">
              <p>Total units</p>
              <h3 id="inventoryTotal">0</h3>
            </div>
            <div class="summary-card">
              <p>Available</p>
              <h3 id="inventoryAvailable">0</h3>
            </div>
            <div class="summary-card">
              <p>Reserved</p>
              <h3 id="inventoryReserved">0</h3>
            </div>
          </div>

          <div class="card table-card">
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Serial / Notes</th>
                    <th>Created</th>
                    <th>Status</th>
                    <th style="width:140px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="inventoryTableBody">
                  <tr>
                    <td colspan="5" class="empty-row">Choose a variant to see inventory.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="inventoryEmptyState" class="empty-state hidden">
              <h3>No inventory records</h3>
              <p>Use the stock form below to set an initial quantity.</p>
            </div>
          </div>

          <div class="card form-card">
            <div>
              <h3>Update stock</h3>
              <p class="muted">The current API exposes quantity-based stock management. Set the new available quantity for this product detail below.</p>
            </div>
            <form id="addInventoryForm">
              <label for="inventoryQuantityInput">New available quantity</label>
              <input type="number" min="0" id="inventoryQuantityInput" required placeholder="e.g. 25">
              <button class="btn primary" type="submit">Save quantity</button>
            </form>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- PRODUCT MODAL -->
  <div class="modal" id="productModal" aria-hidden="true">
    <div class="modal__dialog">
      <header class="modal__header">
        <h2 id="productModalTitle">Add product</h2>
        <button class="icon-button" data-close-modal="productModal">×</button>
      </header>
      <form id="addProductForm">
        <input type="hidden" id="productIdField">
        <label>Product name
          <input type="text" id="productNameInput" required placeholder="Realme 8">
        </label>
        <label>Description
          <textarea id="productDescriptionInput" rows="3" placeholder="Short description"></textarea>
        </label>
        <label>Image URL (optional)
          <input type="url" id="productImageUrlInput" placeholder="https://...">
        </label>
        <label>Upload image (preferred)
          <input type="file" id="productImageFileInput" accept="image/*">
        </label>
        <div class="image-preview">
          <img id="productImagePreview" src="" alt="Preview">
        </div>
        <label>Type / Subcategory ID
          <select id="productTypeSelect" required>
            <option value="">Loading types…</option>
          </select>
        </label>
        <label>Store ID
          <input type="number" min="1" id="productStoreInput" required placeholder="Store identifier">
        </label>
        <div class="modal__actions">
          <button class="btn ghost" type="button" data-close-modal="productModal">Cancel</button>
          <button class="btn primary" type="submit" id="productModalSubmit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- PRODUCT DETAIL MODAL -->
  <div class="modal" id="productDetailModal" aria-hidden="true">
    <div class="modal__dialog">
      <header class="modal__header">
        <h2 id="detailModalTitle">Add variant</h2>
        <button class="icon-button" data-close-modal="productDetailModal">×</button>
      </header>
      <form id="addProductDetailForm">
        <input type="hidden" id="productDetailIdField">
        <label>Serial number
          <input type="text" id="detailSerialInput" required placeholder="RM8-128-8-0001">
        </label>
        <label>Price
          <input type="number" step="0.01" min="0" id="detailPriceInput" required placeholder="499.99">
        </label>
        <label>Quantity available
          <input type="number" min="0" id="detailQuantityInput" required placeholder="20">
        </label>
        <label>Description
          <textarea id="detailDescriptionInput" rows="3" placeholder="Variant description"></textarea>
        </label>
        <div class="attributes-header">
          <div>
            <h4>Attributes (optional)</h4>
            <p class="muted">Select attribute + measure unit pairs fetched from the backend.</p>
          </div>
          <button type="button" class="btn ghost" id="addAttributeRowBtn">Add attribute</button>
        </div>
        <div id="detailAttributesWrapper" class="attributes-wrapper"></div>
        <div class="modal__actions">
          <button class="btn ghost" type="button" data-close-modal="productDetailModal">Cancel</button>
          <button class="btn primary" type="submit" id="detailModalSubmit">Save variant</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>

  <script src="app.js" defer></script>
</body>
</html>
